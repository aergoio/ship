<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ShipLauncher.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ship</a> &gt; <a href="index.source.html" class="el_package">ship.exec</a> &gt; <span class="el_source">ShipLauncher.java</span></div><h1>ShipLauncher.java</h1><pre class="source lang-java linenums">/*
 * @copyright defined in LICENSE.txt
 */

package ship.exec;

import static org.slf4j.LoggerFactory.getLogger;
import static ship.util.Messages.bind;

import hera.util.ExceptionUtils;
import java.util.Optional;
import lombok.RequiredArgsConstructor;
import org.slf4j.Logger;
import ship.Command;
import ship.CommandFactory;
import ship.exception.CommandException;
import ship.util.AnsiMessagePrinter;
import ship.util.MessagePrinter;

<span class="fc" id="L20">@RequiredArgsConstructor</span>
public class ShipLauncher {
<span class="fc" id="L22">  protected static final Logger logger = getLogger(ShipLauncher.class);</span>

<span class="fc" id="L24">  protected static final String NL_0 = ShipLauncher.class.getName() + &quot;.0&quot;;</span>
<span class="fc" id="L25">  protected static final String NL_1 = ShipLauncher.class.getName() + &quot;.1&quot;;</span>
<span class="fc" id="L26">  protected static final String NL_2 = ShipLauncher.class.getName() + &quot;.2&quot;;</span>

  /**
   * ship's entry point.
   *
   * @param args user arguments
   */
  public static void main(final String[] args) {
<span class="nc" id="L34">    logger.info(&quot;Apm launched&quot;);</span>
<span class="nc" id="L35">    final ShipLauncher instance = new ShipLauncher(new AnsiMessagePrinter(System.out));</span>
<span class="nc" id="L36">    instance.run(args);</span>
<span class="nc" id="L37">  }</span>

  protected final MessagePrinter messagePrinter;

  protected void printHelp() {
<span class="fc" id="L42">    messagePrinter.println(bind(NL_0));</span>
<span class="fc" id="L43">  }</span>

  public void exit(int returnCode) {
<span class="nc" id="L46">    System.exit(returnCode);</span>
<span class="nc" id="L47">  }</span>

  /**
   * Create and execute command as user input.
   *
   * @param args user inputs
   */
  public void run(final String[] args) {
<span class="fc bfc" id="L55" title="All 2 branches covered.">    if (args.length &lt; 1) {</span>
<span class="fc" id="L56">      printHelp();</span>
<span class="fc" id="L57">      exit(-1);</span>
    } else {
<span class="fc" id="L59">      final CommandFactory commandFactory = new CommandFactory(messagePrinter);</span>
<span class="fc" id="L60">      final Optional&lt;Command&gt; commandOpt = commandFactory.create(args);</span>
<span class="pc bpc" id="L61" title="1 of 2 branches missed.">      if (!commandOpt.isPresent()) {</span>
<span class="fc" id="L62">        printHelp();</span>
<span class="fc" id="L63">        exit(-1);</span>
      }

<span class="fc" id="L66">      commandOpt.ifPresent(this::execute);</span>
    }
<span class="fc" id="L68">  }</span>

  /**
   * Execute command.
   *
   * &lt;p&gt;
   * Exit process with return code.
   * &lt;/p&gt;
   * @param command command to execute
   */
  public void execute(final Command command) {
    try {
<span class="fc" id="L80">      logger.trace(&quot;{} starting...&quot;, command);</span>
<span class="fc" id="L81">      command.execute();</span>
<span class="fc" id="L82">      exit(0);</span>
<span class="nc" id="L83">    } catch (final CommandException throwable) {</span>
<span class="nc" id="L84">      handleCommandException(command, throwable);</span>
<span class="nc" id="L85">    } catch (final Throwable throwable) {</span>
<span class="nc" id="L86">      handleThrowable(command, throwable);</span>
<span class="pc" id="L87">    }</span>
<span class="fc" id="L88">  }</span>

  protected void handleCommandException(
      final Command command,
      final CommandException commandException) {
<span class="nc" id="L93">    final String message = commandException.getMessage();</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">    if (null != message) {</span>
<span class="nc" id="L95">      messagePrinter.println(bind(NL_1, message));</span>
<span class="nc" id="L96">      logger.error(&quot;Fail to execute {}&quot;, command, commandException);</span>
    } else {
<span class="nc" id="L98">      logger.error(&quot;{}&quot;, commandException.getMessage(), commandException);</span>
    }
<span class="nc" id="L100">    exit(-1);</span>
<span class="nc" id="L101">  }</span>

  protected void handleThrowable(final Command command, final Throwable throwable) {
<span class="nc" id="L104">    final String mainMessage = ExceptionUtils.buildExceptionMessage(null, throwable);</span>
<span class="nc" id="L105">    System.err.println(mainMessage);</span>
<span class="nc" id="L106">    System.err.println(bind(NL_2));</span>
<span class="nc" id="L107">    logger.debug(&quot;Unexpected exception: {}&quot;, throwable.getClass(), throwable);</span>
<span class="nc" id="L108">    exit(-1);</span>
<span class="nc" id="L109">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>